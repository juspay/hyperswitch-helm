# Lightweight Hyperswitch-app instance connected to PostgreSQL
# For 16GB systems - 500MB memory per database
# This instance sends metrics to OTEL port 14317

# PostgreSQL with reduced resources for lightweight testing
postgresql:
  enabled: true
  image:
    repository: bitnami/postgresql
    tag: 16.4.0-debian-12-r23
  primary:
    name: ""
    resources:
      requests:
        cpu: "500m"
        memory: "512Mi"
      limits:
        cpu: "500m"
        memory: "512Mi"
  readReplicas:
    replicaCount: 0

# Disable other embedded services
redis:
  enabled: false

externalRedis:
  enabled: true
  host: hyperswitch-shared-redis-master.hyperswitch-shared.svc.cluster.local
  port: 6379
  auth:
    enabled: false

kafka:
  enabled: false

clickhouse:
  enabled: false

mailhog:
  enabled: false

vector:
  enabled: false

# Enable only router service with reduced resources
services:
  router:
    enabled: true
    version: v1.117.0
    imageRegistry: docker.juspay.io
    image: juspaydotin/hyperswitch-router
  consumer:
    enabled: false
  producer:
    enabled: false
  drainer:
    enabled: false

# Server configuration with reduced resources
server:
  replicas: 1
  resources:
    requests:
      memory: "256Mi"
      cpu: "200m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# Configure OTEL to send to PG receiver port
server:
  configs:
    log:
      telemetry:
        metrics_enabled: true
        otel_exporter_otlp_endpoint: 'otel-collector.hyperswitch-monitoring.svc.cluster.local:14317'
        traces_enabled: true

# Add labels for identification
global:
  labels:
    db_backend: postgresql
    instance: pg

# Disable card vault
hyperswitch-card-vault:
  enabled: false

# Disable autoscaling for consistent testing
autoscaling:
  enabled: false

# Enable initDB
initDB:
  enable: true